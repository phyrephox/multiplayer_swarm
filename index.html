<!doctype html>
<html>
<head>
<title>Socket.IO test</title>
</head>
<body>

<button onclick="test()">button</button>
<canvas id='field' width='1000' height='900' style="border:1px solid #000000;">
your browser does not support html5 canvas</canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
 var ctx = document.getElementById('field').getContext('2d');
 //document.getElementById('field').onkeydown = keyPress;
 window.addEventListener('keydown', keyPress, false);
 
 
 var i=0
 var test = function(){
  i++;
  socket.emit('click',{i:i,j:3,k:{i:i+1}});
 }
 
 var pos = {
  x:250,
  y:250
 };
 function keyPress(e){
  e = e || event;
  if (e.keyCode==38){
   pos.y-=5;
  }
  if (e.keyCode==37){
   pos.x-=5;
  }
  if (e.keyCode==40){
   pos.y+=5;
  }
  if (e.keyCode==39){
   pos.x+=5;
  }
  socket.emit('key', pos);
 }
 
 var socket = io();
 var id;
 
 socket.on('onconnected', function(msg){
  id=msg.id;
  console.log(id);
 });
 
 socket.on('click', function(msg){
  console.log('click '+msg.i+' '+msg.k.i);
 });
 
 /*socket.on('key', function(msg){
  ctx.clearRect(0,0,500,500);
  ctx.fillRect(msg.x,msg.y,10,10);
  pos.x=msg.x;
  pos.y=msg.y;
 });*/
 
 function draw(p){
  ctx.moveTo(p.xpos,p.ypos);
  ctx.lineTo(p.xpos-p.xvel,p.ypos-p.yvel);
 }
 
 socket.on('data', function(msg){
  //console.log(msg);
  ctx.clearRect(0,0,1000,1000);
  ctx.beginPath();
  //console.log(msg['boid'+0]);
  //console.log(msg);
  for(var i=0;i<msg.length;i++){
   //msg[i].draw(ctx);
   //msg['boid'+i].draw(ctx);
   //msg.draw(ctx);
   //console.log(msg[i]);
   draw(msg[i]);
  }
  ctx.closePath();
  ctx.stroke();
 });
 
 
 
</script>

</body>
</html>
